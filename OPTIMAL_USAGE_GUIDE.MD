# Agile Planner: Optimal Workflow with Windsurf Cascade

## 1. Introduction

This document outlines the most effective way to use the Agile Planner MCP server within the Windsurf Cascade environment. The focus is on a **synergistic workflow** that leverages other powerful MCP servers like `Context7` (for documentation/context) and `SequentialThinking` (for planning complex inputs) to maximize the quality and relevance of the artifacts generated by Agile Planner (`generateBacklog` and `generateFeature`).

Instead of simply calling Agile Planner tools directly with basic descriptions, this workflow emphasizes **elaboration, research, and structured planning** as preliminary steps within Cascade.

## 2. The Synergistic Workflow Explained

This recommended workflow integrates seamlessly into a conversation with Cascade:

1.  **Idea / Requirement (User Input):**
    *   The user expresses a need (new project backlog, new feature).
    *   *Example:* "Cascade, we need a feature for user profile editing."

2.  **Elaboration / Research (Cascade + `Context7` / `Brave Search` / Memories):**
    *   Cascade gathers context for the request.
    *   **Crucially, check for existing plans/constraints:** Use `Context7` (if docs are indexed), retrieve relevant Cascade **Memories**, or ask the user about existing architectural decisions or implementation guidelines related to this area.
    *   Use `Context7`/`Brave Search` for external best practices or API docs if needed.
    *   *Example Cascade Action:* "Understood. Before planning, let me check our project memories and `Context7` for any existing decisions regarding user data handling or preferred UI libraries for profile sections... Found a memory indicating we use React Hook Form for forms."

3.  **Structured Planning (Cascade + `SequentialThinking`):**
    *   Cascade uses `SequentialThinking` to break down the requirement, incorporating research findings **and** existing constraints/plans identified in the previous step.
    *   This creates a detailed, context-aware `projectDescription` or `featureDescription`.
    *   *Example Cascade Action:* "Okay, planning with `SequentialThinking`, considering the requirement to use React Hook Form..."

4.  **Generation (Cascade + Agile Planner MCP):**
    *   Cascade calls `mcp0_generateBacklog` or `mcp0_generateFeature` with the rich, structured description.
    *   *Example Cascade Action:* "Calling `mcp0_generateFeature` with the detailed plan for profile editing, including React Hook Form considerations."

5.  **Review & Refinement (User + Cascade + `edit_file`):**
    *   User reviews the output.
    *   Cascade uses `edit_file` for adjustments. Optionally, Cascade *could* be asked to add an initial status marker like `[Status: Generated]` here, but ongoing tracking is separate.

## 3. New Hierarchical Structure (v1.2.0+)

As of version 1.2.0, Agile Planner now organizes all artifacts in a **hierarchical structure**:

```
.agile-planner-backlog/
├── epics/
│   └── [epic-slug]/
│       ├── epic.md
│       └── features/
│           └── [feature-slug]/
│               ├── feature.md
│               └── user-stories/
│                   ├── [story-1].md
│                   └── [story-2].md
├── planning/
│   ├── mvp/
│   │   └── mvp.md (links to actual user stories)
│   └── iterations/
│       └── [iteration-slug]/
│           └── iteration.md (links to actual user stories)
└── backlog.json
```

This hierarchical structure provides several advantages:
- Clear organization of related items (epics contain features, features contain user stories)
- Improved navigation and discoverability
- Explicit relationships between different levels of planning
- Cross-links between planning elements (MVP, iterations) and the actual user stories

When reviewing generated output, be aware of this new structure and navigate the folders accordingly.

## 4. Pragmatic Example: Generating a Feature Aligned with Plans

(Adapting the previous Stripe example slightly to show plan adherence)

**USER:** "Cascade, let's plan the feature for adding Stripe payments to our checkout page."

**CASCADE:** "Okay. First, let me check project documentation via `Context7` and our memories for any specific guidelines on payment integrations... Found a guideline: 'All external payment processing must happen server-side for security compliance'. Now, shall I consult the Stripe Node.js docs via `Context7` for the standard server-side Payment Intent flow?"

**USER:** "Yes, please do."

**CASCADE:** *(Hypothetically uses `Context7`)* "Got it. Now, let's use `SequentialThinking` to structure the feature plan, incorporating the server-side processing requirement and the Stripe flow details..."

**CASCADE:** *(Hypothetically uses `SequentialThinking`)* "Okay, the detailed description is ready, emphasizing server-side PaymentIntent creation. Shall I generate the feature using `mcp0_generateFeature`?"

**USER:** "Yes, proceed."

**CASCADE:** *(Calls `mcp0_generateFeature`)* "Done. Generated files are in the hierarchical structure under `.agile-planner-backlog/epics/[epic-name]/features/stripe-payments/`. Please review."

**USER:** "Looks aligned. Can you add `[Status: Generated]` to each user story title?"

**CASCADE:** *(Calls `edit_file` to add the status marker)* "Done. I've updated all user stories in the `.agile-planner-backlog/epics/[epic-name]/features/stripe-payments/user-stories/` directory."

## 5. Suggested Windsurf Rules (Global or Workspace)

To help Cascade consistently follow this workflow, consider adding rules like these to your Windsurf **Workspace Rules** (recommended for project-specific workflows) or Global Rules configuration.

*Workspace Rules* are generally preferred here as they associate this specific synergistic behavior with the Agile Planner project/workspace, rather than applying it globally to all Cascade interactions.

```mcp
# RULE 1: Suggest Research for Features needing External Context
- When asked to use `mcp0_generateFeature`, if the request mentions specific technologies, external APIs (like 'Stripe', 'Google Maps', etc.), or complex concepts, AND the provided `featureDescription` seems brief, THEN first **suggest** using `Context7` (for docs) or `Brave Search` (for general info) to gather context before proceeding.

# RULE 2: Suggest Planning for Complex Features/Backlogs
- After gathering context (via `Context7` or `Brave Search`) for `mcp0_generateFeature`, OR when asked to use `mcp0_generateBacklog` with a project description that seems complex (e.g., listing many distinct functional areas, involving non-trivial concepts), THEN **suggest** using `SequentialThinking` to structure a detailed description (`featureDescription` or `projectDescription`) before calling the relevant Agile Planner MCP tool.

# RULE 3: Prioritize Context7 for Documentation
- When research is needed for a known library or framework (e.g., 'React', 'Next.js', 'Stripe'), prioritize using `Context7` over `Brave Search`.

# RULE 4: Check Existing Plans/Architecture
- Before generating a feature (`mcp0_generateFeature`) or backlog (`mcp0_generateBacklog`), **suggest** checking project documentation via `Context7` (if relevant docs are indexed) and/or retrieving relevant Cascade **Memories** for existing implementation plans, architectural constraints, or style guides related to the feature/project domain. Incorporate findings into the planning step (using `SequentialThinking`).
```

*(Note: These are examples; tailor them to your specific needs and prompting style. Rule 2 now explicitly covers `generateBacklog` alongside `generateFeature` for complex planning scenarios.)*

**A Note on Progress Tracking:**

While Cascade can be asked to add an initial marker like `[Status: Generated]` to items upon creation (as shown in the example, via `edit_file`), this workflow and the Agile Planner MCP **do not** automatically track the implementation status of generated user stories or features. Ongoing progress tracking (e.g., moving items to "In Progress" or "Done") should typically be managed in your primary project management system (Jira, Trello, Asana, etc.), which might consume the initial Markdown/JSON output generated here.

## 6. Conclusion

By adopting this synergistic workflow—incorporating **checks for existing plans**, leveraging `Context7`/`Brave`/Memories for context, and using `SequentialThinking` for planning—before invoking the Agile Planner MCP tools, you significantly enhance the quality, consistency, and completeness of the generated project artifacts. This approach turns Cascade and your MCP server into a more powerful, context-aware planning assistant.

---

## Appendix: Agile Planner MCP Tool Reference

*(Details moved from the main body for clarity)*

### A.1. `generateBacklog`

*   **Description:** Generates a complete agile project backlog (epics, user stories) from a project description.
*   **Code Source:** `server/lib/backlog-generator.js`
*   **Input Parameters:**
    *   `projectName` (string, **required**): Name of the project.
    *   `projectDescription` (string, **required**): Detailed description of goals/scope.
    *   `outputPath` (string, *optional*): Custom output directory. Defaults to `AGILE_PLANNER_OUTPUT_ROOT` env var or `./output`.
*   **Output:** Markdown/JSON backlog files in `outputPath`.

### A.2. `generateFeature`

*   **Description:** Generates a specific feature with user stories.
*   **Code Source:** `server/lib/feature-generator.js`
*   **Input Parameters:**
    *   `featureDescription` (string, **required**): Detailed description of the feature.
    *   `businessValue` (string, *optional*): Business value proposition.
    *   `storyCount` (integer, *optional*, default: 3, min: 3): Number of user stories.
    *   `iterationName` (string, *optional*, default: 'next'): Iteration name.
    *   `outputPath` (string, *optional*): Custom output directory. Defaults as above.
*   **Output:** Markdown/JSON feature files in `outputPath`.
